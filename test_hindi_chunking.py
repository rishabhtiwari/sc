#!/usr/bin/env python3
"""
Test script to verify text chunking for Hindi text locally
"""

import sys
import os

# Add the audio-generation utils to path
sys.path.insert(0, os.path.join(os.path.dirname(__file__), 'audio-generation', 'utils'))

# Test Hindi text
hindi_text = """सत्युग की बात है। एक बार देश में दुर्भिक्ष पड़ा। वर्षा के अभाव से अन्न नही हुआ। पशुओ के लिए चारा नही रहा। दूसरे वर्ष भी वर्षा नही हुई। विपत्ति बढ़ती गयी। नदी-तालाब सूख चले। मार्तण्ड की प्रचण्ड किरणों से धरती रसहीन हो गयी। तृण भस्म हो गए। वृक्ष निष्प्राण हो चले मनुष्यों और पशुओं में हाहाकार मच गया।

दुर्भिक्ष बढ़ता गया। एक वर्ष नही, दो वर्ष नही पुरे बाहर वर्षो तक अनावृष्टि रही। लोग त्राहि-त्राहि करने लगे। कहीं अन्न नही, जल , तृण नही, वर्षा और शीत ऋतुएँ नही। सर्वत्र सर्वदा एक ही ग्रीष्म-ऋतु धरती से उड़ती धूल और अग्नि में सनी तेज लू। आकाश में पंख पसारे दल-के-दल उड़ते पक्षियों के दर्शन दुर्लभ हो गये। पशु पक्षी ही नही, कितने मनुष्य काल के गाल में गए, कोई संख्या नही। मात्र-स्तनो मे दूध न पाकर कितने सुकुमार शिशु मृत्यु की गोद में सो गए, कौन जाने! नर-कंकालो देखकर करुणा भी करुणा से भीग जाती, किन्तु एक मुट्ठी अन्न किसकी कोई कहा से देता। नरेश का अक्षय कोष और धनपतीयो के धन अन्न की व्यवस्था कैसे करते? परिस्थिति उत्तरोत्तर बिगड़ती ही चली गयी। प्राणों के लाले पड़ गये।

किसी ने बतलाया की नरमेघ किया गया तो वर्षा हो सकती है। लोगो को बात जँची; पर प्राण सबको प्यारे है। बलात् किसकी बलि दी नही जा सकती।

विशाल जन-समाज एकत्र हुआ था, पर सभी चुपचाप थे। सबके सर झुके थे। अचानक नीरवता भङग् हुई। सबने दृष्टि उठायी, देखा बारह वर्ष का अत्यन्त सुन्दर बालक खड़ा है। उसके अङ्ग-अङ्ग से कोमलता जैसे चू रही है। उसने कहा, 'उपस्थित महानभावो! असंख्य प्राणियों की रक्षा एवं देश को संकट की स्थति से छुटकारा दिलाने के लिये मेरे प्राण सहर्ष प्रस्तुत है। यह प्राण देश के है और देश के लिए अप्रित हो, इससे अधिक सदुपयोग इनका और क्या होगा? इसे बहाने विव्श्रत्मा प्रभु की सेवा इस कायासे हो जायगी।'

'बेटा शतमन्यु! तू धन्य है।' चिल्लाते हुए एक व्यक्ति दौड़कर उसे अपने हृदय से कस लिया। वे उसके पिता थे। 'तूने अपने पूर्वजों को अमर कर दिया।' शतमन्यु की जननी भी वहीँ थी। समीप आ गयीं। उनकी आँखे झर रही थी। उन्होंने शतमन्यु को अपनी छाती इस प्रकार चिपका लिया, जैसे कभी नही छोड़ सकेगी।

नियत समय पर समारोह के साथ यज्ञ प्रारम्भ हुआ। शतमन्यु को अनेक तीर्थों के जल से स्नान कराकर नवीन वस्त्रा-भूषण पहनाये गए। सुगन्धित चन्दन लगाया गया। पुष्प मालाओं से अंलकृत किया गया।

बालक यज्ञ-मण्डप में आया। यज्ञ-स्तम्भ के समीप खड़ा होकर वह देवराज स्मरण करने लगा। यज्ञ-मण्डप शांत एवं नीरव था। बालक सिर झुकाये बलि के लिए तैयार था; एकत्रित जन- समुदाय मौन होकर उधर एकटक देख रहा था, उसी क्षण शून्य में विचित्र बाजे बज उठे।शतमन्यु पर पारिजात-पुष्पो की वृष्टि होने लगी। सहसा मेघ ध्वनि के साथ वज्रधर सुरेन्द्र प्रकट हो गए। सब लोग आँख फ़ाड़े आश्चर्य के साथ देख रहे थे।

शतमन्यु के मस्तक पर अत्यन्त प्यार से अपना वरद हस्त फेरते हुए सुरपति बोले – 'वत्स! तेरी भक्ति और देश की कल्याण-भावना से मै संतुष्ट हुँ। जिस देश के बालक देश की रक्षा के लिए प्राण अर्पण करने को प्रतिक्षण प्रस्तुत रहते हैं, उस देश का कभी पतन नही हो सकता। तेरे त्याग से संतुष्ट होकर मै बलि के बिना ही यज्ञ-फल प्रदान कर दूँगा। देवेन्द्र अन्तर्धान हो गये।'

दूसरे दिन इतनी वृष्टि हुई की धरती पर जल-ही-जल दिखने लगा। सर्वत अत्र-जल, फल-फूल का प्राचुर्य हो गया। एक देश-प्राण शतमन्यु के त्याग, तप एवं कल्याण की भावना ने सर्वत्र पवित्र आनन्द की सरिता बहा दी।"""

def main():
    print("=" * 80)
    print("TESTING HINDI TEXT CHUNKING")
    print("=" * 80)
    print(f"\nInput text length: {len(hindi_text)} characters")
    print(f"Input text preview: {hindi_text[:100]}...")
    print("\n" + "=" * 80)
    
    try:
        from text_chunker import chunk_text
        
        # Test with max_chars=150 (default)
        max_chars = 150
        print(f"\nTesting with max_chars={max_chars}")
        print("-" * 80)
        
        chunks = chunk_text(hindi_text, max_chars=max_chars, language_code='hi')
        
        print("\n" + "=" * 80)
        print("FINAL CHUNKS SUMMARY")
        print("=" * 80)
        print(f"\nTotal chunks created: {len(chunks)}")
        
        for i, chunk in enumerate(chunks):
            print(f"\n--- Chunk {i+1} ---")
            print(f"Length: {len(chunk)} characters")
            print(f"Content: {chunk}")
            
            # Warn about very small chunks
            if len(chunk) < 50:
                print(f"⚠️  WARNING: This chunk is very small ({len(chunk)} chars)!")
        
        print("\n" + "=" * 80)
        print("CHUNK SIZE DISTRIBUTION")
        print("=" * 80)
        
        size_ranges = {
            "0-50": 0,
            "51-100": 0,
            "101-150": 0,
            "151-200": 0,
            "201-250": 0,
            "251+": 0
        }
        
        for chunk in chunks:
            length = len(chunk)
            if length <= 50:
                size_ranges["0-50"] += 1
            elif length <= 100:
                size_ranges["51-100"] += 1
            elif length <= 150:
                size_ranges["101-150"] += 1
            elif length <= 200:
                size_ranges["151-200"] += 1
            elif length <= 250:
                size_ranges["201-250"] += 1
            else:
                size_ranges["251+"] += 1
        
        for range_name, count in size_ranges.items():
            if count > 0:
                print(f"{range_name} chars: {count} chunks")
        
        print("\n" + "=" * 80)
        
    except ImportError as e:
        print(f"\n❌ Error: Could not import text_chunker module")
        print(f"   {e}")
        print(f"\nPlease install required dependencies:")
        print(f"   pip install spacy num2words")
        print(f"   python -m spacy download hi_core_news_sm")
        print(f"   python -m spacy download en_core_web_sm")

if __name__ == "__main__":
    main()

